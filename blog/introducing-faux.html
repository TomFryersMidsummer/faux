<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>introducing faux - faux</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../faux.html">faux</a></li><li class="chapter-item expanded affix "><a href="../motivation.html">Motivation</a></li><li class="chapter-item expanded "><a href="../guide/getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Stub Behavior (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Argument Matching (Coming Soon)</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Equality (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> Any (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.3.</strong> Pattern (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.4.</strong> Custom Closure (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.5.</strong> Advanced (Coming Soon)</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Pointer Receivers (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Interactions With Other Macros (Coming Soon)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> External Modules (Coming Soon)</div></li><li class="chapter-item expanded "><a href="../guide/exporting-mocks.html"><strong aria-hidden="true">7.</strong> Exporting Mocks Across Crates</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Unsafe Uses (Coming Soon)</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../blog/introducing-faux.html" class="active">introducing faux</a></li><li class="chapter-item expanded affix "><a href="../blog/an-inside-look.html">an inside look</a></li><li class="chapter-item expanded affix "><a href="../blog/landing-v-0-1.html">landing v0.1</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>

                        <h1 class="menu-title">faux</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="--introducing-faux--"><a class="header" href="#--introducing-faux--">ðŸŽ‰ ðŸŽ‰ Introducing faux ðŸŽ‰ ðŸŽ‰</a></h1>
<h2 id="what-is-faux"><a class="header" href="#what-is-faux">What is faux?</a></h2>
<p><a href="https://github.com/nrxus/faux"><code>faux</code></a> is a traitless Rust mocking framework for creating mock
objects out of user-defined structs.</p>
<h2 id="why-mock"><a class="header" href="#why-mock">Why mock?</a></h2>
<p>Mock objects are test versions of objects that contain fake
implementations of their behavior. For example, if your code accesses
your file system, makes network requests, or performs other expensive
actions, it is often useful to mock that behavior. Mocking can help
make your tests into true unit tests that run quickly and produce the
same result every time without relying on external dependencies. For a
deeper dive into mocks, read this <a href="https://martinfowler.com/articles/mocksArentStubs.html">post</a>.</p>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">extern crate faux;
</span><span class="boring">
</span>#[cfg_attr(test, faux::create)]
<span class="boring">#[faux::create]
</span>pub struct NetworkClient {
    /* data here */
}

#[cfg_attr(test, faux::methods)]
<span class="boring">#[faux::methods]
</span>impl NetworkClient {
    pub fn fetch_id_matching(&amp;self, a: u32) -&gt; i32 {
        /* does some complicated stuff, maybe network calls */
<span class="boring">        5
</span>    }
}

struct Service {
    client: NetworkClient,
}

impl Service {
    fn do_stuff(&amp;self) -&gt; i32 {
        self.client.fetch_id_matching(3)
    }
}

#[cfg(test)]
#[test]
fn service_does_the_right_thing() {
    // creates a mocked NetworkClient
    let mut client = NetworkClient::faux();

    faux::when!(client.fetch_id_matching).then(|i| {
        // we want to test do_stuff(), which should always call
        // fetch_id_matching with the input 3.
        assert_eq!(i, 3, &quot;expected service to send '3'&quot;);
        // mock fetch_id_matching to always return 10
        10
    });

    // create your service using the mocked client
    // the service is the subject under test
    let subject = Service { client };
    let id = subject.do_stuff();
    assert_eq!(id, 10);
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">   // creates a mocked NetworkClient
</span><span class="boring">   let mut client = NetworkClient::faux();
</span><span class="boring">
</span><span class="boring">   // mock fetch_id_matching
</span><span class="boring">   faux::when!(client.fetch_id_matching).then(|i| {
</span><span class="boring">        assert_eq!(i, 3, &quot;expected service to send '3'&quot;);
</span><span class="boring">        10
</span><span class="boring">   });
</span><span class="boring">
</span><span class="boring">   // create your service using the mocked client
</span><span class="boring">   // the service is the subject under test
</span><span class="boring">   let subject = Service { client };
</span><span class="boring">   let id = subject.do_stuff();
</span><span class="boring">   assert_eq!(id, 10);
</span><span class="boring">}
</span></code></pre></pre>
<p>By adding <code>faux</code> attributes, we have succesfully mocked
<code>NetworkClient::fetch_id_matching</code> to instead call a closure specified
in the test code and always return 10. Unlike the real method, the
mock does not make a network request. Thus, our test remains
dependable, focused, and free from external dependencies.</p>
<p><code>faux</code> provides users with two attributes: <code>#[faux::create]</code> and
<code>#[faux::methods]</code>. <code>#[faux::create]</code> is required on any struct that
needs to be mocked and <code>#[faux::methods]</code> is required on its <code>impl</code>
block. <code>faux</code> also provides a <code>when!</code> macro to mock methods that
were made mockable by <code>#[faux::methods]</code>. See the <a href="https://docs.rs/faux/">docs</a> for more information.</p>
<h2 id="how-is-faux-different-than-existing-mocking-framework"><a class="header" href="#how-is-faux-different-than-existing-mocking-framework">How is faux different than ${existing mocking framework}?</a></h2>
<p><strong>DISCLAIMER: this section is based on the author's knowledge of Rust
mocking frameworks as of January 2020. Apologies in advance for any
frameworks that were overlooked.</strong></p>
<p>Currently in Rust, mocking depends heavily on traits.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct NetworkClient {
    /* data here */
}

impl NetworkClient {
    fn fetch_id_matching(&amp;self, a: u32) -&gt; i32 {
        /* does some complicated stuff, maybe network calls */
<span class="boring">        5
</span>    }
}

struct Service {
    client: NetworkClient,
}

impl Service {
    fn do_stuff(&amp;self) -&gt; i32 {
        self.client.fetch_id_matching(3)
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>In the code snippet above, we want to test <code>Service</code> to make sure it
does the right thing. However, we want to avoid the expensive work
done in <code>fetch_id_matching</code>, since making a network call in our test
would be both slow and unreliable. This means we need two different
implementations of <code>NetworkClient</code>: one for tests, and one for
production. Using a common trait for the two implementations, we could
write the following:</p>
<pre><pre class="playground"><code class="language-rust">trait TNetworkClient {
    fn fetch_id_matching(&amp;self, a: u32) -&gt; i32;
}

struct NetworkClient {
    /* data here */
}

impl TNetworkClient for NetworkClient {
    fn fetch_id_matching(&amp;self, a: u32) -&gt; i32 {
        /* does some complicated stuff, maybe network calls */
<span class="boring">        5
</span>    }
}

struct Service&lt;C: TNetworkClient&gt; {
    client: C,
}

impl&lt;C: TNetworkClient&gt; Service&lt;C&gt; {
    fn do_stuff(&amp;self) -&gt; i32 {
        self.client.fetch_id_matching(3)
    }
}

#[cfg(test)]
struct MockNetworkClient {
    mocked_fetch_id_matching_result: i32,
    mocked_fetch_id_matching_argument: std::cell::Cell&lt;u32&gt;,
}

#[cfg(test)]
impl TNetworkClient for MockNetworkClient {
    fn fetch_id_matching(&amp;self, a: u32) -&gt; i32 {
        self.mocked_fetch_id_matching_argument.set(a);
        self.mocked_fetch_id_matching_result
    }
}

<span class="boring">struct MockNetworkClient {
</span><span class="boring">    mocked_fetch_id_matching_result: i32,
</span><span class="boring">    mocked_fetch_id_matching_argument: std::cell::Cell&lt;u32&gt;,
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl TNetworkClient for MockNetworkClient {
</span><span class="boring">    fn fetch_id_matching(&amp;self, a: u32) -&gt; i32 {
</span><span class="boring">        self.mocked_fetch_id_matching_argument.set(a);
</span><span class="boring">        self.mocked_fetch_id_matching_result
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>
#[cfg(test)]
#[test]
fn service_does_the_right_thing() {
    //creates a mocked NetworkClient
    let client = MockNetworkClient {
        mocked_fetch_id_matching_argument: std::cell::Cell::default(),
        mocked_fetch_id_matching_result: 10,
    };

    // create your service using the mocked client
    // the service is the subject under test
    let subject = Service { client };
    let id = subject.do_stuff();
    assert_eq!(id, 10);
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    //creates a mocked NetworkClient
</span><span class="boring">    let client = MockNetworkClient {
</span><span class="boring">        mocked_fetch_id_matching_argument: std::cell::Cell::default(),
</span><span class="boring">        mocked_fetch_id_matching_result: 10,
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    // create your service using the mocked client
</span><span class="boring">    // the service is the subject under test
</span><span class="boring">    let subject = Service { client };
</span><span class="boring">    let id = subject.do_stuff();
</span><span class="boring">    assert_eq!(id, 10);
</span><span class="boring">}
</span></code></pre></pre>
<p>Unfortunately, we have now changed our <em>production</em> code to
accommodate our <em>tests</em>, not because this is a better design but
because of testing requirements. Tests should <em>guide</em> the design of
your code without forcing undue complexity that only benefits the
tests. Now, every user of <code>Service</code> needs to explicitly call out the
<code>TNetworkClient</code> trait, thus cluttering the function/struct signature
of anything dealing with <code>Service</code>. Furthermore, the <code>TNetworkClient</code>
trait is an unnecessary layer of abstraction for your production code,
which only uses one implementation of the trait.</p>
<p>While the code above is a simple example, imagine having to add mock
interfaces to all the structs in a mature codebase. Most mocking
frameworks for Rust are currently based on this approach. Although
most can automatically generate the mock structs from traits, you
still need to define hand-written traits for every mockable struct,
and you still have to deal with generics and traits in your
function/struct signatures.</p>
<p><code>faux</code> takes a different approach by transforming your struct and its
methods into mockable versions of themselves. These transformations
can be (and should be!) gated to only the <code>test</code> cfg, thus having zero
impact on your production code.</p>
<h2 id="closing-note"><a class="header" href="#closing-note">Closing note</a></h2>
<p><code>faux</code> is in a very early stage of development, and definitely does
not cover all the possibilities of a traitless mocking
framework. Thus, there is no guarantee of API stability between
releases, although every attempt will be made to keep the API
consistent. Please read the <a href="https://docs.rs/faux/">docs</a> for the most up to date information
on <code>faux</code> functionality.</p>
<p>See the <a href="https://github.com/nrxus/faux/issues">issues</a> in Github for an updated list of limitations and to get
an idea of what might be coming next.</p>
<p>Feedback is always welcome, so feel free to open issues or send PRs.</p>
<p>A huge thanks to <a href="https://github.com/CodeSandwich/Mocktopus">mocktopus</a>, another traitless Rust mocking
framework, which was a huge inspiration behind the creation of <code>faux</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guide/exporting-mocks.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../blog/an-inside-look.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a href="../guide/exporting-mocks.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a href="../blog/an-inside-look.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
